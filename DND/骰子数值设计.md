# 关于DND的骰子数值设计

## 攻击掷骰

掷骰 $x \text{d} y$ ，$x$表示掷骰次数，$y$表示骰子大小。$dy$ 的骰子意味着 $[1,y]$ 上的离散概率分布，其期望如下：
$$E(1dy)=\frac{1+y}{2}$$
对于一个 $d20$ 骰子，其期望为$\frac{1+20}{2}=10.5$。

由于大数定律与中心极限定理，随着掷骰次数 $x$ 的增加，概率分布更趋近于正态分布。
由于独立性，重复 $x$ 次掷骰的**总期望**随着掷骰次数的增加，期望增加。
$$E(xdy) = x·E(1dy) = x · \frac{1+y}{2}$$


方差 $D(1dy)=\frac{y^2-1}{12}$ ，重复 $x$ 次掷骰后总方差为：
$$D(xdy) =  x·D(1dy) = x·\frac{y^2-1}{12}$$

### 常见xdy数值对比与掷骰次数

对于 $a \text{d} b$ 与 $b \text{d} a$的期望分析如下：

$E(adb) = a * \frac{1+b}{2} = \frac{ab+a}{2} \\
 E(bda) = b * \frac{1+a}{2} = \frac{ab+b}{2}$

即当 $x>y$ 时 $xdy$ 的期望优于 $ydx$。

---

对于 $a \text{d} b$ 与 $b \text{d} a$的方差分析如下：
$D(adb) = a · \frac{b^2-1}{12} = \frac{ab^2-a}{12} \\
 D(bda) = b · \frac{a^2-1}{12} = \frac{a^2b-b}{12}$

当 $D(adb)>D(bda)$ 时，有 $ab^2-a > a^2b-b$。
则 $ab^2-a-a^2b+b>0$，即 $(ab+1)(b-a)>0$
仅当 $b>a$ 时成立。

即当 $x>y$ 时，$xdy$ 的方差小于 $ydx$。

>这意味着，一把4d3的长剑要远远优于3d4的长剑，因为其期望更高，并且方差更小，掷骰结果更稳定。
这个差距会随着x与y的差距变大。如5d100拥有期望252.5，而100d5拥有期望300，并且100d5的方差远远小于5d100。

---

更一般的，对于一个 $x \text{d} \frac{C}{x}$ 的掷骰，期望为：
$$ Expect = x · \frac{1+\frac{C}{x}}{2} = \frac{x+C}{2}$$

对于固定的常数 $C$ ，期望主要取决于**掷骰次数**。

方差为：
$$ Var = x · \frac{(\frac{C}{x})^2-1}{12} = \frac{C^2-x^2}{12x}$$
其中：
$$ Var' = -\frac{1}{12} · \frac{x^2+C^2}{x^2} < 0,x\in Z^+$$
随着掷骰次数的增加，方差减小。

---

这意味着对于形如 $x \text{d} \frac{C}{x}$ 的掷骰对比，结果优劣更取决于**掷骰次数**。

### 命中对抗数值分析

命中鉴定主要取决于d20骰，当投掷出20，则认为大成功，当投掷出1，则认为大失败。对于任意的AC值，都有5%的概率大成功或大失败。暂时不考虑任何调整值。

对于一个**大于等于20**的AC值，仅5%的概率大成功时命中。

对于任何处于 $[2,19]$ 的AC值，记 $AC_\text{base}$ ，各有5%的概率大成功或大失败。
在**一般情况**下，掷骰范围为 $[2,19]$ ，只需在 $[AC,19]$ 范围内即成功。
其概率为：
$$90\% ·\frac{19- AC_\text{base} +1}{18} = (100-5AC_\text{base})\%$$

对于小于2的AC值，仅大失败时不命中，命中率95%。

---

敌人的AC值会收到自身防御调整值的提升，我方攻击判定也会伴随命中调整值。其调整值为直接加和。除了大成功与大失败，攻击命中即为以下内容的**对抗**：

$$d20 + \text{modifier}_\text{attack} \geq AC_\text{base} + \text{modifier}_\text{AC}$$

由于调整值是独立于概率计算进行简单加和的，攻击调整值与AC调整值可以简单的相抵。

在整个对抗过程中，计算概率的部分只有攻击方的d20，其他数值项均为**静态**计算的。为了方便计算，做以下考虑：计AC调整值与攻击调整值的差值为 
$$moderror = |\text{modifier}_\text{AC} - \text{modifier}_\text{attack}|$$
则**命中概率** $P_\text{hit} = P(\{1d20 \geq AC_\text{base} \pm moderror | 1d20 \neq 1,1d20 \neq 20\} + \{1d20 = 20\})$，即：
$$(100-5AC_\text{base} \pm 5moderror)\% + 5\%$$

- 当 $moderror=0$ 时，整个对抗还原为命中概率 $(100-5AC_\text{base})\% + 5\% = 105\% -5AC_\text{base}\%$。
- 当 $moderror \neq 0$ 时，则变化为 $105\% - 5AC_\text{base}\%  \pm 5moderror\%$

---

为了方便计算，合并 $AC_\text{base}$ 与$moderror$，记 $d = |AC - modifier_\text{attack}|$。

当**攻击调整值多于AC值**，除大失败必命中，概率为95%。
当**攻击调整值小于AC值**时，

$$
P_\text{hit} =
\begin{cases}
95\%, & d \leq 1 \\
90\% ·\frac{20 - d}{18}+5\% = 105\% - 5d\%, & 2 \leq d \leq 19 \\
5\%, & d \geq 20
\end{cases}
$$

### AC与攻击加值的收益

由于DND/pf均采用d20小数值计算，数值的膨胀十分敏感。
任何导致AC与攻击调整值的差距变化都会引起至少5%的起伏，在常见区间内，仅仅两三点攻击调整值的提升足以带来10%~15%的命中率收益。
其单位受益为**二十分之一**，5%。
# C++网络编程

## 重识一些概念

- 局域网
  局域网并不意味着范围小,只要你想,几个跨洲际的国家也能组成局域网.
  局域网所强调的是区域内的各类计算机与设备所组成的私有网络.
- 广域网
  广域网才是印象中的所谓"外网"或"公网",是链接不同地区局域网/城域网计算机的远程公共网络.
  路由器所组成了一个小的局域网,路由器上连着的网线则真正连接到了外网.
- IP
  IP只是一组数,用来标识一个计算机.
  在局域网内部你通常会见到192.168.x.x的私有地址.
  如果路由器连着网线或者PC主机上插着网线,那么你应当能够连接到外网.
  即便没插网线,在这个小的局域网内部你可以仍能ping通内部的私有ip.
- 端口
  端口用来标识一个进程,并不是所有进程都需要端口,如果一个进程压根不涉及网络功能他也没必要申请一个端口.
  由于端口需要唯一标识一个进程,所以端口不能复用.

## 重识分层模型

- TCP/IP四层模型
  ISO的上三层被合并成TCP/IP的应用层
  传输层仍是传输层
  网络层则变成了TCP/IP的网络互联层
  数据链路层和物理层则合并成了TCP/IP的网络接口层

在网络通信时,程序员只负责应用层数据处理.
在应用层的数据本身也可以使用一些协议封装(可标准也可不标准)后再下放,也可以不封装.
下层的操作一些都通过socket这个API完成,socket的背后是操作系统.

## socket接口

socket的单词含义是插座
socket由加利福尼亚大学伯克利分校的研究所研发,其目的是将TCP/IP协议的相关软件移植到UNIX系统.
开发者开发的接口让应用程序能简单地调用它来进行通信,该接口的不断完善形成了socket套接字.
Linux系统里采用了Socket套接字,并被广泛使用,现在已成为事实上的标准.

## 字节序

在源向目的发送数据后,数据存储在内存的某个位置,此时大小端就会对这个数据做出不同的解释.
因此我们还要定义字节序,定义好是大端还是小端.

- 小端: 低对低,高对高
- 大端: 低对高,高对低

C/C++提供了大小端转化函数

```
uint16_t htons(uint16_t hostshort);
uint16_t htonl(uint16_t hostlong);
uint16_t ntohs(uint16_t netshort);
uint16_t ntohl(uint16_t netshort);
```

## TCP协议

所谓四次挥手,其实是各自挥两次,谁先发起都无所谓.
一次挥手关闭一侧的连接,两侧完全关闭.